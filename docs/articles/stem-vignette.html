<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>stemhelper: STEM Use and Helper Functions • stemhelper</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">stemhelper</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/stem-vignette.html">Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CornellLabofOrnithology/stemhelper">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>stemhelper: STEM Use and Helper Functions</h1>
                        <h4 class="author">Tom Auer &amp; Daniel Fink</h4>
            
            <h4 class="date">2017-09-21</h4>
          </div>

    
    
<div class="contents">
<div id="outline" class="section level1">
<h1 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h1>
<ol style="list-style-type: decimal">
<li>Background</li>
<li>Projections, Loading Raster, Conversion</li>
<li>Mapping Occurrence and Abundance</li>
<li>Extracting Trajectories with Uncertainty</li>
<li>Plotting Predictor Importance and Partial Dependencies</li>
</ol>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>1. Background</h1>
<p>Many ecological and conservation problems require comprehensive, high-resolution information about the spatial and temporal distribution and abundance of species’ populations. This poses a challenge because observations of species are often sparsely and irregularly distributed, especially for widely distributed species. To address this challenge, species distribution models are used to estimate species’ distributions in unobserved locations and times. By associating local environmental characteristics with observed patterns of species occurrence and abundance statistical models provide a framework to harness available data and make estimates in unobserved areas. Additionally, these models can be used to control for known sources of biases that arise from the observation process.</p>
<p>The relative abundance estimates described here were based on bird observation data from <a href="www.ebird.org">eBird</a>, a citizen-science program administered by Cornell Lab of Ornithology, and local land cover descriptions derived from NASA MODIS and other remote sensing data. Individual species’ distributions and abundance were modeled using a spatio-temporal ensemble of boosted regression using the Spatio-Temporal Exploratory Model (STEM) framework (see Fink et al. 2010, 2014 and Johnston et al. 2015).</p>
<p>These models were then used to produce one daily abundance and occurrence estimate per week for all 52 weeks of the year. For each week, estimates were made across a regular grid of ~4 million locations that cover the terrestrial Western Hemisphere at a resolution of 2.8km x 2.8km. Variation in detectability associated with the search effort is controlled by standardizing the estimates to be the expected count of the species on a search conducted from 7-8AM while traveling 1 km on the given day at the given location by a typical eBirder.</p>
<p>Each relative abundance estimate was computed as an ensemble average of up to 100 randomized base models. Averaging across an ensemble of base model estimates, each trained on random subsample of the data, produces a smoothed bootstrap (Efron 2014) or a bagged estimator. For each abundance estimate we also computed upper and lower limits as the 10th and 90th percentiles across the ensemble. These limits are conservative estimates of the sampling variation of the smoothed bootstrap estimator, for the reasons discussed in Efron (2014), and because they are based on subsamples of the full data set.</p>
<div id="data-access" class="section level2">
<h2 class="hasAnchor">
<a href="#data-access" class="anchor"></a>Data access</h2>
<p>To access STEM results, begin by <a href="https://secure.birds.cornell.edu/cassso/login">creating an eBird account and signing in</a>. The visit the <a href="http://ebird.org/ebird/data/download">Download Data</a> page. STEM data access is free; however, you will need to <a href="http://ebird.org/ebird/data/request">request access</a> in order to obtain access to the STEM data. Filling out the access request form allows eBird to keep track of the number of people using the data and obtain information on the applications for which the data are used.</p>
<p>Once you have access to the data, proceed to the <a href="http://ebird.org/ebird/data/download/ebd">download page</a>. Here you will be able to download data for all species or for a list of 225 individual species. TBD…</p>
</div>
<div id="data-structure-and-types" class="section level2">
<h2 class="hasAnchor">
<a href="#data-structure-and-types" class="anchor"></a>Data Structure and Types</h2>
<p>Estimates from STEM are currently provided in the widely used GeoTiff raster format. These are easily opened with the raster package in R, as well as with a variety of GIS software tools.</p>
<p>TODO: Revisit this section The results are organized by species and each species has two groupings of results: “all_layers” and “presentation”. The “all_layers” group contains the raw data layers about estimates and have not been thresholded. The “presentation” group contains data layers that have been thresholded. For each week, thresholded estimates have been restricted to locations that meet two criteria. First, each location was estimated to be occupied by the species, and, second, the location had sufficient eBird data to support non-zero abundance estimates for at least 50 of the 100 base models.</p>
<p>The animated GIFs distributed with the data are generated using the “presentation” abundance estimates. It is highly suggested to use this GIF visualization as a means for sanity checking.</p>
</div>
</div>
<div id="projection-and-loading-rasters" class="section level1">
<h1 class="hasAnchor">
<a href="#projection-and-loading-rasters" class="anchor"></a>2. Projection and Loading Rasters</h1>
<div id="projection" class="section level2">
<h2 class="hasAnchor">
<a href="#projection" class="anchor"></a>Projection</h2>
<p>The GeoTiffs use the same Sinusoidal projection that the MODIS data uses. As part of this package, we provide a template raster, that contains the spatial extent, resolution, and land water definition (as a 0 value) for our modeled region. To access, call the <code>template_raster</code> object after loading the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">template_raster</code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 1907, 2267, 4323169  (nrow, ncol, ncell)
## resolution  : 8339.629, 8339.629  (x, y)
## extent      : -20015109, -1109171, -6674483, 9229189  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m +no_defs 
## data source : /Users/mta45/Downloads/srd2016_wh_raster_template_3xagg.tif 
## names       : srd2016_wh_raster_template_3xagg 
## values      : 0, 0  (min, max)</code></pre>
</div>
<div id="loading-rasters" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-rasters" class="anchor"></a>Loading Rasters</h2>
<p>Once you have accessed and downloaded a set of STEM results, the first task is to load them into R in a way that they can be used easily. To save space on disk, each individual raster (e.g., abundance mean for Wood Thrush for January 4) has had NA values trimmed before saving (using the raster package trim() function). While this saves space on disk, it means that the rasters are not immediately comparable and trying to use the raster <code>stack()</code> function will fail. To assist with the loading of rasters, we have provided a helper function, <code><a href="../reference/stack_stem.html">stack_stem()</a></code>, which uses the <code>template_raster</code> object to extend each input raster in a directory to the full extent of analysis and then returns a <code>RasterStack</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># TODO set this up to do a curl of the example results first</span>

<span class="co"># Note, if you currently access results you can use this path construction</span>
<span class="co"># by replacing the root_path with where your copy lives</span>
root_path &lt;-<span class="st"> "~/Box Sync/Projects/2015_stem_hwf/documentation/data-raw/"</span>
species &lt;-<span class="st"> "woothr-ERD2016-PROD-20170505-3f880822"</span>
sp_path &lt;-<span class="st"> </span><span class="kw">paste</span>(root_path, species, <span class="dt">sep =</span> <span class="st">""</span>)

<span class="co"># load a stack of rasters with the helper function stack_stem()</span>
abund_stack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stack_stem.html">stack_stem</a></span>(sp_path, <span class="dt">variable =</span> <span class="st">"abundance_umean"</span>)
<span class="kw">print</span>(abund_stack)</code></pre></div>
<pre><code>## class       : RasterStack 
## dimensions  : 1907, 2267, 4323169, 52  (nrow, ncol, ncell, nlayers)
## resolution  : 8339.629, 8339.629  (x, y)
## extent      : -20015109, -1109171, -6674483, 9229189  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m +no_defs 
## names       : woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, woothr.ER//ance_umean, ... 
## min values  :           0.015118375,           0.015788087,           0.033285676,           0.052928034,           0.024066419,           0.029316657,           0.032420257,           0.022123046,           0.005116472,           0.007878265,           0.008822452,           0.006654291,           0.012099929,           0.013628872,           0.015761521, ... 
## max values  :             1.3302507,             1.6452209,             1.9444350,             1.8349457,             1.4688664,             1.2054517,             1.0085490,             1.0894841,             1.0850736,             1.0477763,             0.9113657,             0.7379155,             0.5582393,             0.5659341,             0.7697676, ...</code></pre>
<p>In most use cases, this function will be used to stack the 52 weeks of a single variable (e.g., abundance mean) for a single species. However, if the STEM .tif rasters were re-arranged, the function could be used to, for example, stack single weeks for a single variable across multiple species.</p>
</div>
<div id="conversion" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion" class="anchor"></a>Conversion</h2>
<p>The <code>raster</code> package has a lot of functionality and the RasterLayer format is useful for spatial analysis and mapping, but some users do not have GIS experience or want the data in a simpler format for their preferred method of analysis. There are multiple ways to get more basic representations of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># To convert the data to a simpler geographic format and access tabularly   </span>
<span class="co"># reproject into geographic (decimal degrees) </span>
abund_stack_ll &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(abund_stack[[<span class="dv">26</span>]], 
                                        <span class="dt">crs =</span> sp::<span class="kw">CRS</span>(<span class="st">"+init=epsg:4326"</span>))

<span class="co"># Convert raster object into a matrix</span>
p &lt;-<span class="st"> </span>raster::<span class="kw">rasterToPoints</span>(abund_stack_ll)
<span class="kw">colnames</span>(p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"abundance_umean"</span>)
<span class="kw">head</span>(p)</code></pre></div>
<pre><code>##      longitude latitude abundance_umean
## [1,] -94.91638  48.7625       0.2094019
## [2,] -94.83988  48.7625       0.1718842
## [3,] -94.53388  48.7625       0.1721756
## [4,] -94.45738  48.7625       0.2931008
## [5,] -94.38088  48.7625       0.5760729
## [6,] -94.30438  48.7625       0.3509973</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write a CSV file of the matrix</span>
<span class="kw">write.csv</span>(p, 
          <span class="dt">file =</span> <span class="kw">paste</span>(raster_dir, <span class="st">"/woothr_week26.csv"</span>, <span class="dt">sep=</span><span class="st">""</span>),
          <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
</div>
<div id="mapping-occurrence-and-abundance" class="section level1">
<h1 class="hasAnchor">
<a href="#mapping-occurrence-and-abundance" class="anchor"></a>3. Mapping Occurrence and Abundance</h1>
<p>One of the most common activities with STEM results is to make plots of occurrence and abundance. It is fast and easy to make plots immediately, but to get ideal plotting behavior takes a little bit of preparation. This sections describes some helper functions intended to assist with mapping.</p>
<div id="projections-and-calculating-full-annual-spatial-extent" class="section level2">
<h2 class="hasAnchor">
<a href="#projections-and-calculating-full-annual-spatial-extent" class="anchor"></a>Projections and Calculating Full-annual Spatial Extent</h2>
<p>The sinusoidal projection that NASA provides MODIS data in, while functional because of its equal-area property, is not good for mapping because of the significant distortion of land masses across the globe. There are few global equal-area projections, including, but not limited to, Lambert Azimuthal Equal Area, Goode Homolosine, Mollweide, and Equal Area Cylindrical. Of these, we have selected Mollweide, used in the remainder of this section, for its pleasing conformal properties across the globe, ease of projection configuration within R and the proj4string construction, and the ease of setting central meridians that best display the Western Hemisphere. It is worth noting that while projecting to a more visually appealing projection is ideal for mapping, it is not necessary for quantitative analysis of STEM results, for which purposes the results can be left in the sinusoidal projection.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(viridis)

<span class="co"># define mollweide projection</span>
mollweide &lt;-<span class="st"> </span>sp::<span class="kw">CRS</span>(<span class="st">"+proj=moll +lon_0=-90 +x_0=0 +y_0=0 +ellps=WGS84"</span>)

<span class="co"># project single layer from stack to mollweide</span>
week1_moll &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(abund_stack[[<span class="dv">1</span>]], <span class="dt">crs =</span> mollweide)

<span class="co"># optionally, you can project an entire stack, but it takes much longer</span>
<span class="co">#abund_stack_moll &lt;- raster::projectRaster(abund_stack, crs = mollweide)</span>

<span class="co"># plot single layer with full annual extent</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>))
raster::<span class="kw">plot</span>(week1_moll, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>,
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="dv">20</span>),
             <span class="dt">maxpixels =</span> raster::<span class="kw">ncell</span>(week1_moll))</code></pre></div>
<p><img src="stem-vignette_files/figure-html/project_stack-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
<p>Plotting the layer at the full spatial extent of the analysis area makes for a small map. The process of building the stack unifies the extent of all layers in the stack. However, this also means that plotting happens at the full spatial extent of the area of analysis, the Western Hemisphere, as seen above. If we calculate the full annual spatial extent for the species, project to Mollwide, and then map, we get an extent that works for the entire full-annual cycle of the species.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the full annual extent on the abundance stack (in sinusoidal projection)</span>
sp_ext &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_full_extent.html">calc_full_extent</a></span>(abund_stack)

<span class="co"># project the full annual extent to Mollweide</span>
extent_raster &lt;-<span class="st"> </span>raster::<span class="kw">raster</span>(<span class="dt">ext =</span> sp_ext, 
                                <span class="dt">crs =</span> sp::<span class="kw">proj4string</span>(template_raster))
extent_raster[<span class="kw">is.na</span>(extent_raster)] &lt;-<span class="st"> </span><span class="dv">1</span>
sp_ext_moll &lt;-<span class="st"> </span>raster::<span class="kw">extent</span>(raster::<span class="kw">projectRaster</span>(extent_raster, 
                                                    <span class="dt">crs =</span> mollweide))

<span class="co"># plot the first week of the abundance stack in Mollweide</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>))
raster::<span class="kw">plot</span>(week1_moll, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll, 
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="dv">20</span>),
             <span class="dt">maxpixels=</span>raster::<span class="kw">ncell</span>(week1_moll))</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_stack_extent-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-occurrence" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-occurrence" class="anchor"></a>Mapping Occurrence</h2>
<p>Most examples in this vignette focus primarily on abundance predictions, as they’re the most novel and informative. However, we also provide the probability of occurrence predictions. These are much simpler to plot than abundance, as values range between 0 and 1 throughout the year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load a stack of occurrence</span>
occ_stack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stack_stem.html">stack_stem</a></span>(sp_path, <span class="dt">variable =</span> <span class="st">"occurrence_umean"</span>)

<span class="co"># create breaks every 0.05 from 0 to 1</span>
occ_bins &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.05</span>)
occ_week26 &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(occ_stack[[<span class="dv">26</span>]], <span class="dt">crs =</span> mollweide)

<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">cex =</span> <span class="fl">0.7</span>)
raster::<span class="kw">plot</span>(occ_week26, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll,
             <span class="dt">breaks =</span> occ_bins,
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="kw">length</span>(occ_bins) -<span class="st"> </span><span class="dv">1</span>),
             <span class="dt">maxpixels =</span> raster::<span class="kw">ncell</span>(occ_week26))</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_occurrence-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="calculating-abundance-bins" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-abundance-bins" class="anchor"></a>Calculating Abundance Bins</h2>
<p>Mapping species abundance across the full-annual cycle presents a challenge, in that patterns of concentration and dispersion in abundance change throughout the year, making it difficult to define color bins that suit all seasons and accurately reflect the detail of abundance predictions. To address this, we selected a method (described by Maciejewski et al. 2013) that log transforms the entire year of data, constructs bins with the log-transformed data using standard deviations, and then un-transforms the bins for plotting.</p>
<p>To compare, we first scale the colors linearly, based on the maximum from the entire year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_max &lt;-<span class="st"> </span><span class="kw">max</span>(raster::<span class="kw">maxValue</span>(abund_stack), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

week26_moll &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(abund_stack[[<span class="dv">26</span>]], <span class="dt">crs =</span> mollweide)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))
raster::<span class="kw">plot</span>(week1_moll, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll, 
             <span class="dt">zlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, year_max),
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="dv">20</span>),
             <span class="dt">maxpixels =</span> raster::<span class="kw">ncell</span>(week1_moll),
             <span class="dt">legend=</span><span class="ot">FALSE</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>))
raster::<span class="kw">plot</span>(week26_moll, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll, 
             <span class="dt">zlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, year_max),
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="dv">20</span>),
             <span class="dt">maxpixels =</span> raster::<span class="kw">ncell</span>(week26_moll))</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_linear-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
<p>We can compare this with plots made using the binning method provided here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_bins &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_bins.html">calc_bins</a></span>(abund_stack)

<span class="co"># create a thinner set of labels</span>
bin_labels &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">round</span>(year_bins, <span class="dv">2</span>), <span class="dt">nsmall =</span> <span class="dv">2</span>)
bin_labels[!(bin_labels %in%<span class="st"> </span><span class="kw">c</span>(bin_labels[<span class="dv">1</span>], 
                    bin_labels[<span class="kw">round</span>((<span class="kw">length</span>(bin_labels) /<span class="st"> </span><span class="dv">4</span>)) +<span class="st"> </span><span class="dv">1</span>], 
                    bin_labels[<span class="kw">round</span>((<span class="kw">length</span>(bin_labels) /<span class="st"> </span><span class="dv">2</span>)) +<span class="st"> </span><span class="dv">1</span>],
                    bin_labels[<span class="kw">length</span>(bin_labels) -<span class="st"> </span>
<span class="st">                               </span><span class="kw">round</span>((<span class="kw">length</span>(bin_labels) /<span class="st"> </span><span class="dv">4</span>)) +<span class="st"> </span><span class="dv">1</span>],
                    bin_labels[<span class="kw">length</span>(bin_labels)]))] &lt;-<span class="st"> ""</span>

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))
raster::<span class="kw">plot</span>(week1_moll, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll, 
             <span class="dt">breaks =</span> year_bins,
             <span class="dt">lab.breaks =</span> bin_labels,
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="kw">length</span>(year_bins) -<span class="st"> </span><span class="dv">1</span>),
             <span class="dt">maxpixels =</span> raster::<span class="kw">ncell</span>(week1_moll),
             <span class="dt">legend =</span> <span class="ot">FALSE</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>))
raster::<span class="kw">plot</span>(week26_moll, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll, 
             <span class="dt">breaks =</span> year_bins,
             <span class="dt">lab.breaks =</span> bin_labels,
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="kw">length</span>(year_bins) -<span class="st"> </span><span class="dv">1</span>),
             <span class="dt">maxpixels=</span>raster::<span class="kw">ncell</span>(week26_moll))</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_bins-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-abundance" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-abundance" class="anchor"></a>Mapping Abundance</h2>
<p>With a good full-annual extent and color bins, that accurately represent the data distribution, we can add in other pieces of data that represent predicted and assumed zeroes, which help display the extent of estimation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pull in species-specific ensemble support, represent predicted 0s where there is no abundance value</span>
pos_es_stack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stack_stem.html">stack_stem</a></span>(sp_path, <span class="dt">variable =</span> <span class="st">"abundance_ensemble_support"</span>)
week26_pes &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(pos_es_stack[[<span class="dv">26</span>]], <span class="dt">crs =</span> mollweide)

<span class="co"># to represent assumed 0s, we have provided the data object zero_es_stack</span>
<span class="co"># that has values for the ensemble support indicating sufficient checklists</span>
<span class="co"># to fit and predict models at that location</span>
<span class="co"># for presentation we use a value of 99 to show locations with assumed 0s</span>
zero_es_stack</code></pre></div>
<pre><code>## class       : RasterStack 
## dimensions  : 1907, 2267, 4323169, 52  (nrow, ncol, ncell, nlayers)
## resolution  : 8339.629, 8339.629  (x, y)
## extent      : -20015109, -1109171, -6674483, 9229189  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181 +b=6371007.181 +units=m +no_defs 
## names       : Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, Western_H//le_support, ... 
## min values  :                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0,                     0, ... 
## max values  :                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100,                   100, ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">week26_zes_vals &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(raster::<span class="kw">mask</span>(zero_es_stack[[<span class="dv">26</span>]], 
                                                 template_raster), 
                                    <span class="dt">crs =</span> mollweide)

<span class="co"># we'll combine the two types of zeroes with the positive prediction for plotting</span>
week26_pes[week26_pes] &lt;-<span class="st"> </span><span class="dv">0</span>
week26_zes &lt;-<span class="st"> </span>week26_zes_vals &gt;=<span class="st"> </span><span class="dv">99</span>
week26_zes[week26_zes ==<span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
week26_zes[week26_zes ==<span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">0</span>

week26s &lt;-<span class="st"> </span>raster::<span class="kw">stack</span>(week26_pes, week26_zes, week26_moll)
week26c &lt;-<span class="st"> </span>raster::<span class="kw">calc</span>(week26s, max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="co"># to add context, let's pull in some reference data to add</span>
wh &lt;-<span class="st"> </span>rnaturalearth::<span class="kw">ne_countries</span>(<span class="dt">continent =</span> <span class="kw">c</span>(<span class="st">"North America"</span>,
                                                <span class="st">"South America"</span>))
wh_states &lt;-<span class="st"> </span>rnaturalearth::<span class="kw">ne_states</span>(<span class="dt">iso_a2 =</span> <span class="kw">unique</span>(wh@data$iso_a2))
wh_moll &lt;-<span class="st"> </span>sp::<span class="kw">spTransform</span>(wh, mollweide)
wh_states_moll &lt;-<span class="st"> </span>sp::<span class="kw">spTransform</span>(wh_states, mollweide)

<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>))
raster::<span class="kw">plot</span>(week26c, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>,
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll, 
             <span class="dt">breaks =</span> year_bins,
             <span class="dt">lab.breaks =</span> bin_labels,
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="kw">length</span>(year_bins)-<span class="dv">1</span>),
             <span class="dt">maxpixels =</span> raster::<span class="kw">ncell</span>(week26c),
             <span class="dt">legend =</span> <span class="ot">TRUE</span>)
sp::<span class="kw">plot</span>(wh_moll, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">border =</span> <span class="st">'gray'</span>)
sp::<span class="kw">plot</span>(wh_states_moll, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">border =</span> <span class="st">'gray'</span>, <span class="dt">lwd =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_es-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="mapping-abundance-confidence-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-abundance-confidence-intervals" class="anchor"></a>Mapping Abundance Confidence Intervals</h2>
<p>In addition to occurrence and abundance predictions, we also provide confidence intervals at an upper value of 90% and lower value of 10%. These can be used to calculate and map a confidence band width.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load lower and upper stacks</span>
lower_stack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stack_stem.html">stack_stem</a></span>(sp_path, <span class="dt">variable =</span> <span class="st">"abundance_lower"</span>)
upper_stack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stack_stem.html">stack_stem</a></span>(sp_path, <span class="dt">variable =</span> <span class="st">"abundance_upper"</span>)

<span class="co"># calculate band width</span>
conf_band &lt;-<span class="st"> </span>upper_stack -<span class="st"> </span>lower_stack

conf_week26 &lt;-<span class="st"> </span>raster::<span class="kw">projectRaster</span>(conf_band[[<span class="dv">26</span>]], <span class="dt">crs =</span> mollweide)

<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>))
raster::<span class="kw">plot</span>(conf_week26, 
             <span class="dt">xaxt =</span> <span class="st">'n'</span>, 
             <span class="dt">yaxt =</span> <span class="st">'n'</span>,
             <span class="dt">bty =</span> <span class="st">'n'</span>,
             <span class="dt">ext =</span> sp_ext_moll,
             <span class="dt">col =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">magma</a></span>(<span class="dv">20</span>),
             <span class="dt">maxpixel=</span>raster::<span class="kw">ncell</span>(conf_week26))</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_confidence-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="extracting-trajectories-with-uncertainty" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-trajectories-with-uncertainty" class="anchor"></a>4. Extracting Trajectories with Uncertainty</h1>
<p>With raster stacks for abundance, upper, and lower confidence intervals, we can extract an abundnace trajectory, with uncertainty intervals and plot them across the year for a single location.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set a point</span>
coords &lt;-<span class="st"> </span><span class="kw">cbind</span>(-<span class="fl">76.5</span>, <span class="fl">42.5</span>)
pt &lt;-<span class="st"> </span>sp::<span class="kw">SpatialPoints</span>(coords, <span class="dt">proj4string =</span> sp::<span class="kw">CRS</span>(<span class="st">"+init=epsg:4326"</span>))
pt_prj &lt;-<span class="st"> </span>sp::<span class="kw">spTransform</span>(pt, sp::<span class="kw">CRS</span>(sp::<span class="kw">proj4string</span>(template_raster)))

<span class="co"># extract</span>
abund_traj &lt;-<span class="st"> </span><span class="kw">unlist</span>(raster::<span class="kw">extract</span>(abund_stack, 
                                     pt_prj, 
                                     <span class="dt">fun =</span> mean, 
                                     <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
upper_traj &lt;-<span class="st"> </span><span class="kw">unlist</span>(raster::<span class="kw">extract</span>(upper_stack, 
                                     pt_prj, 
                                     <span class="dt">fun =</span> mean, 
                                     <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
lower_traj &lt;-<span class="st"> </span><span class="kw">unlist</span>(raster::<span class="kw">extract</span>(lower_stack, 
                                     pt_prj, 
                                     <span class="dt">fun =</span> mean, 
                                     <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

<span class="co"># Plot trajectories</span>
<span class="kw">library</span>(ggplot2)

plot_frame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>:<span class="kw">length</span>(abund_traj),
                         <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">unname</span>(abund_traj)),
                         <span class="dt">upper =</span> <span class="kw">c</span>(<span class="kw">unname</span>(upper_traj)),
                         <span class="dt">lower =</span> <span class="kw">c</span>(<span class="kw">unname</span>(lower_traj)))

g &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(plot_frame, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(x, y)) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">data =</span> plot_frame) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">data =</span> plot_frame, 
                 <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), 
                 <span class="dt">alpha =</span> <span class="fl">0.3</span>) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Expected Count (count/(km hr))"</span>) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Week"</span>)
g</code></pre></div>
<p><img src="stem-vignette_files/figure-html/trajectories-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
<p>It is also possible to extract trajectories for regions, but it takes a little more data work.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set a point</span>
coords &lt;-<span class="st"> </span><span class="kw">cbind</span>(-<span class="fl">76.5</span>, <span class="fl">42.5</span>)
pt &lt;-<span class="st"> </span>sp::<span class="kw">SpatialPoints</span>(coords, <span class="dt">proj4string =</span> sp::<span class="kw">CRS</span>(<span class="st">"+init=epsg:4326"</span>))
pt_prj &lt;-<span class="st"> </span>sp::<span class="kw">spTransform</span>(pt, sp::<span class="kw">CRS</span>(sp::<span class="kw">proj4string</span>(template_raster)))

<span class="co"># set an extent based on polygon</span>
us &lt;-<span class="st"> </span>rnaturalearth::<span class="kw">ne_states</span>(<span class="dt">geounit =</span> <span class="st">"United States of America"</span>)
us_prj &lt;-<span class="st"> </span>sp::<span class="kw">spTransform</span>(us, sp::<span class="kw">CRS</span>(sp::<span class="kw">proj4string</span>(template_raster)))
wv &lt;-<span class="st"> </span>us_prj[us_prj@data$name ==<span class="st"> "West Virginia"</span>,]

<span class="co"># extract</span>
<span class="co"># because we're using regions, we get lots of values that we need to average together</span>
abund_traj &lt;-<span class="st"> </span>raster::<span class="kw">extract</span>(abund_stack, wv, <span class="dt">fun =</span> mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
abund_traj &lt;-<span class="st"> </span><span class="kw">apply</span>(abund_traj, <span class="dv">2</span>, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

upper_traj &lt;-<span class="st"> </span>raster::<span class="kw">extract</span>(upper_stack, wv, <span class="dt">fun =</span> mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
upper_traj &lt;-<span class="st"> </span><span class="kw">apply</span>(upper_traj, <span class="dv">2</span>, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

lower_traj &lt;-<span class="st"> </span>raster::<span class="kw">extract</span>(lower_stack, wv, <span class="dt">fun =</span> mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
lower_traj &lt;-<span class="st"> </span><span class="kw">apply</span>(lower_traj, <span class="dv">2</span>, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="co"># Plot trajectories</span>
<span class="kw">library</span>(ggplot2)

plot_frame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>:<span class="kw">length</span>(abund_traj),
                         <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">unname</span>(abund_traj)),
                         <span class="dt">upper =</span> <span class="kw">c</span>(<span class="kw">unname</span>(upper_traj)),
                         <span class="dt">lower =</span> <span class="kw">c</span>(<span class="kw">unname</span>(lower_traj)))

g &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(plot_frame, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(x, y)) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">data =</span> plot_frame) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">data =</span> plot_frame, 
                 <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span>upper), 
                 <span class="dt">alpha =</span> <span class="fl">0.3</span>) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Expected Count (count/(km hr))"</span>) +
<span class="st">     </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Week"</span>)
g</code></pre></div>
<p><img src="stem-vignette_files/figure-html/trajectories_region-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-predictor-importance-and-partial-dependencies" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-predictor-importance-and-partial-dependencies" class="anchor"></a>5. Plotting Predictor Importance and Partial Dependencies</h1>
<p>To complete…</p>
<div id="loading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading Data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># path to species bundle</span>
sp_path &lt;-<span class="st"> </span><span class="kw">paste</span>(root_path, species, <span class="dt">sep =</span> <span class="st">""</span>)

pis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_pis.html">load_pis</a></span>(sp_path)
pds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_pds.html">load_pds</a></span>(sp_path)</code></pre></div>
</div>
<div id="select-region-and-season" class="section level2">
<h2 class="hasAnchor">
<a href="#select-region-and-season" class="anchor"></a>Select Region and Season</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ne_extent &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">type =</span> <span class="st">"rectangle"</span>,
                  <span class="dt">lat.min =</span> <span class="dv">40</span>,  
                      <span class="dt">lat.max =</span> <span class="dv">47</span>,
                      <span class="dt">lon.min =</span> -<span class="dv">80</span>,
                      <span class="dt">lon.max =</span> -<span class="dv">70</span>,
                      <span class="dt">t.min =</span> <span class="fl">0.425</span>,
                      <span class="dt">t.max =</span> <span class="fl">0.475</span>)

<span class="kw"><a href="../reference/map_centroids.html">map_centroids</a></span>(<span class="dt">pis =</span> pis, <span class="dt">pds =</span> pds, <span class="dt">st_extent =</span> ne_extent)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/map_centroids-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="plot-available-centroids-and-extent-of-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-available-centroids-and-extent-of-analysis" class="anchor"></a>Plot available centroids and extent of analysis</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>))
pi_extent &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_effective_extent.html">calc_effective_extent</a></span>(ne_extent, <span class="dt">pis =</span> pis)
pd_extent &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_effective_extent.html">calc_effective_extent</a></span>(ne_extent, <span class="dt">pds =</span> pds)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_extents-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="plot-predictor-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-predictor-importance" class="anchor"></a>Plot Predictor Importance</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with all classes</span>
<span class="kw"><a href="../reference/plot_pis.html">plot_pis</a></span>(pis, <span class="dt">st_extent =</span> ne_extent, <span class="dt">by_cover_class =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_pis-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># aggregating fragstats for cover classes</span>
<span class="kw"><a href="../reference/plot_pis.html">plot_pis</a></span>(pis, <span class="dt">st_extent =</span> ne_extent, <span class="dt">by_cover_class =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_pis-2.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="plot-partial-depedencies" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-partial-depedencies" class="anchor"></a>Plot Partial Depedencies</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mypds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_pds.html">plot_pds</a></span>(<span class="dt">pd_name =</span> <span class="st">"EFFORT_HRS"</span>, 
                  <span class="dt">pds =</span> pds, 
                  <span class="dt">st_extent =</span> ne_extent, 
                  <span class="dt">pointwise_pi =</span> <span class="ot">TRUE</span>, 
                  <span class="dt">stixel_pds =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/plot_pds-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="cake-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#cake-plots" class="anchor"></a>Cake Plots</h2>
<p>When PIs and PDs are combined with can get predictor importance with directionality. By week, these can be turned into a stacked area chart (we affectionately call cake plots) that show the relative predictor importance and directionality by week.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this requires a fair amount of computation, about 5 minutes</span>
<span class="kw"><a href="../reference/cake_plot.html">cake_plot</a></span>(<span class="dt">path =</span> sp_path,
          <span class="dt">pis =</span> pis,
          <span class="dt">pds =</span> pds,
          <span class="dt">st_extent =</span> ne_extent,
          <span class="dt">by_cover_class =</span> <span class="ot">TRUE</span>,
          <span class="dt">pland_and_lpi_only =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="stem-vignette_files/figure-html/cake_plots-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
<div id="references" class="section level3">
<h3 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h3>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#outline">Outline</a></li>
      <li>
<a href="#background">1. Background</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data-access">Data access</a></li>
      <li><a href="#data-structure-and-types">Data Structure and Types</a></li>
      </ul>
</li>
      <li>
<a href="#projection-and-loading-rasters">2. Projection and Loading Rasters</a><ul class="nav nav-pills nav-stacked">
<li><a href="#projection">Projection</a></li>
      <li><a href="#loading-rasters">Loading Rasters</a></li>
      <li><a href="#conversion">Conversion</a></li>
      </ul>
</li>
      <li>
<a href="#mapping-occurrence-and-abundance">3. Mapping Occurrence and Abundance</a><ul class="nav nav-pills nav-stacked">
<li><a href="#projections-and-calculating-full-annual-spatial-extent">Projections and Calculating Full-annual Spatial Extent</a></li>
      <li><a href="#mapping-occurrence">Mapping Occurrence</a></li>
      <li><a href="#calculating-abundance-bins">Calculating Abundance Bins</a></li>
      <li><a href="#mapping-abundance">Mapping Abundance</a></li>
      <li><a href="#mapping-abundance-confidence-intervals">Mapping Abundance Confidence Intervals</a></li>
      </ul>
</li>
      <li><a href="#extracting-trajectories-with-uncertainty">4. Extracting Trajectories with Uncertainty</a></li>
      <li>
<a href="#plotting-predictor-importance-and-partial-dependencies">5. Plotting Predictor Importance and Partial Dependencies</a><ul class="nav nav-pills nav-stacked">
<li><a href="#loading-data">Loading Data</a></li>
      <li><a href="#select-region-and-season">Select Region and Season</a></li>
      <li><a href="#plot-available-centroids-and-extent-of-analysis">Plot available centroids and extent of analysis</a></li>
      <li><a href="#plot-predictor-importance">Plot Predictor Importance</a></li>
      <li><a href="#plot-partial-depedencies">Plot Partial Depedencies</a></li>
      <li><a href="#cake-plots">Cake Plots</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
