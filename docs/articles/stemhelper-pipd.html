<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Predictor Importance and Partial Dependence Information • stemhelper</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">stemhelper</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/stemhelper-intro-mapping.html">Intro Vignette</a>
</li>
<li>
  <a href="../articles/stemhelper-pipd.html">Advanced Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CornellLabofOrnithology/stemhelper">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Using Predictor Importance and Partial Dependence Information</h1>
                        <h4 class="author">Tom Auer, Daniel Fink</h4>
            
            <h4 class="date">2017-11-10</h4>
          </div>

    
    
<div class="contents">
<div id="outline" class="section level1">
<h1 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h1>
<ol style="list-style-type: decimal">
<li>Introduction</li>
<li>Loading Centroids</li>
<li>Selecting Region and Season</li>
<li>Plotting Centroids and Extent of Analysis</li>
<li>Plot Predictor Importance</li>
<li>Plot Partial Dependencies</li>
<li>Cake Plots</li>
</ol>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h1>
<p>Beyond estimates of occurrence and relative abundance, the STEM workflow generates information about predictor importance and partial dependencies, as well as predictive performance metrics (PPMs). The PPMs can be used to evaluate statistical performance of the models, either over the entire spatiotemporal extent of the model results, or for a specific region and season. Predictor Importances (PIs) and Partial Dependencies (PDs) can be used to understand relationships between occurrence and abundance and predictors, most notably the land cover variables used in the model. When PIs and PDs are combined, we can depict habitat association and avoidance, as well as the strength of the relationship with those habitats. The functions described in this section help load this data from the results packages, give tools for assessing predictive performance, and synthesize information about predictor importances and partial dependencies.</p>
<div id="data-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#data-structure" class="anchor"></a>Data Structure</h2>
<p><strong>IMPORTANT. AFTER DOWNLOADING THE RESULTS AND UNZIPPING THEM, DO NOT CHANGE THE FILE STRUCTURE.</strong> All functionality in this package relies on the structure inherent in the delivered results. Changing the folder and file structure will cause errors with this package. You can move the unzipped folder of results wherever you like, but you cannot change the structure within the folder.</p>
<p>Data for stixel centroids are stored in three files, found under \&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results\abund_preds\unpeeled_folds, as described below.</p>
<p>\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\<br>
\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results<br>
\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results\abund_preds<br>
\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results\abund_preds\unpeeled_folds<br>
\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results\abund_preds\unpeeled_folds\pi.txt<br>
\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results\abund_preds\unpeeled_folds\pd.txt<br>
\&lt;six_letter_code-ERD2016-PROD-date-uuid&gt;\results\abund_preds\unpeeled_folds\summary.txt</p>
<p>The <code>stemhelper</code> package provides functions for accessing these, such that you should never have to handle them manually, granted that the original file structure of the results is maintained.</p>
</div>
</div>
<div id="loading-centroids" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-centroids" class="anchor"></a>2. Loading Centroids</h1>
<p>The first step when working with stixel centroid data is to load the Predictor Importances (PIs) and the Partial Dependencies (PDs). These files will be used for all of the functions in this vignette and are the input to many of the functions in <code>stemhelper</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># TODO set this up to do a curl of the example results first</span>

<span class="co"># SETUP PATHS</span>
<span class="co"># Once you have downloaded and unzipped the results, place the resulting folder,</span>
<span class="co"># with the unique species ID name (e.g., woothr-ERD2016-PROD-20170505-3f880822)</span>
<span class="co"># wherever you want to keep it. Then provide the root_path variable as that</span>
<span class="co"># location (without the unique species ID name) and provide the unique species </span>
<span class="co"># ID name as the species variable below. Use the paste() functiont to combine</span>
root_path &lt;-<span class="st"> "~/Box Sync/Projects/2015_stem_hwf/documentation/data-raw/"</span>
species &lt;-<span class="st"> "woothr-ERD2016-PROD-20170505-3f880822"</span>
sp_path &lt;-<span class="st"> </span><span class="kw">paste</span>(root_path, species, <span class="dt">sep =</span> <span class="st">""</span>)

pis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_pis.html">load_pis</a></span>(sp_path)
pds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_pds.html">load_pds</a></span>(sp_path)</code></pre></div>
</div>
<div id="selecting-region-and-season" class="section level1">
<h1 class="hasAnchor">
<a href="#selecting-region-and-season" class="anchor"></a>3. Selecting Region and Season</h1>
<p>When working with Predictive Performance Metrics (PPMs), PIs, and/or PDs, it is very common to select a subset of space and time for analysis. In <code>stemhelper</code> this is done with a list object that has the following structure. This defines the region and season for analysis and is passed to many functions in <code>stemhelper</code>. To review the available stixel centroids associated with both PIs and PDs and to see which have been selected by a spatiotemporal subset, use the <code>map_centroids</code> function, which will map and summarize this information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ne_extent &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">type =</span> <span class="st">"rectangle"</span>,
                  <span class="dt">lat.min =</span> <span class="dv">40</span>,  
                      <span class="dt">lat.max =</span> <span class="dv">47</span>,
                      <span class="dt">lon.min =</span> -<span class="dv">80</span>,
                      <span class="dt">lon.max =</span> -<span class="dv">70</span>,
                      <span class="dt">t.min =</span> <span class="fl">0.425</span>,
                      <span class="dt">t.max =</span> <span class="fl">0.475</span>)

<span class="kw"><a href="../reference/map_centroids.html">map_centroids</a></span>(<span class="dt">pis =</span> pis, <span class="dt">pds =</span> pds, <span class="dt">st_extent =</span> ne_extent)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/map_centroids-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-centroids-and-extent-of-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-centroids-and-extent-of-analysis" class="anchor"></a>4. Plotting Centroids and Extent of Analysis</h1>
<p>Similarly, the <code>calc_effective_extent</code> will analyze a spatiotemporal subset of PIs or PDs and plot the selected stixel centroids, as well as a RasterLayer depicting where a majority of the information is coming from. The map ranges from 0 to 1, with pixels have a value of 1 meaning that 100% of the selected stixels are contributing information at that pixel. The function returns the RasterLayer in addition to mapping.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">6</span>))
pi_extent &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_effective_extent.html">calc_effective_extent</a></span>(ne_extent, <span class="dt">pis =</span> pis)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/plot_extents-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="predictive-performance-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#predictive-performance-metrics" class="anchor"></a>5. Predictive Performance Metrics</h1>
<p>After reviewing the subsetted information and understanding the spatial distribution of information contributing to the subsetted data, it is important to review predictive performance metrics, to get an idea as to whether there is substantial statistical performance to evaluate information provided by PIs and PDs (as well as abundance and occurrence informtion).</p>
<div id="binary-metrics-by-time" class="section level2">
<h2 class="hasAnchor">
<a href="#binary-metrics-by-time" class="anchor"></a>Binary Metrics by Time</h2>
<p>The <code>plot_binary_by_time</code> function analyzes a species’ entire range of data and plots predictive performance metrics by a custom time interval (typicall either 52 for weeks or 12 for months).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_binary_by_time.html">plot_binary_by_time</a></span>(sp_path, <span class="dt">metric =</span> <span class="st">"Kappa"</span>, <span class="dt">n_time_periods =</span> <span class="dv">52</span>)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/binary_by_time-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="all-metrics-for-spatiotemporal-extent" class="section level2">
<h2 class="hasAnchor">
<a href="#all-metrics-for-spatiotemporal-extent" class="anchor"></a>All Metrics for Spatiotemporal Extent</h2>
<p>The <code>plot_all_ppms</code> function provides all available predictive performance metrics and is important for determining predictive performance within a spatiotemporal subset region and season. Further, this function is useful in comparing the performance between subsets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_all_ppms.html">plot_all_ppms</a></span>(sp_path, ne_extent)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/all_ppms-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="plot-predictor-importance" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-predictor-importance" class="anchor"></a>6. Plot Predictor Importance</h1>
<p>Once predictive performance has been evaluated, exploring information about habitat association and/or avoidance can be done using the PIs and PDs. The <code>plot_pis</code> function generates a bar plot showing a rank of the most important predictors within a spatiotemporal subset. There is an option to show all predictors or to aggregate Fragstats by the land cover types.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with all classes</span>
<span class="kw"><a href="../reference/plot_pis.html">plot_pis</a></span>(<span class="dt">path =</span> sp_path, pis, <span class="dt">st_extent =</span> ne_extent, <span class="dt">by_cover_class =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/plot_pis-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># aggregating fragstats for cover classes</span>
<span class="kw"><a href="../reference/plot_pis.html">plot_pis</a></span>(<span class="dt">path =</span> sp_path, pis, <span class="dt">st_extent =</span> ne_extent, <span class="dt">by_cover_class =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/plot_pis-2.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="plot-partial-depedencies" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-partial-depedencies" class="anchor"></a>7. Plot Partial Depedencies</h1>
<p>Complementary to <code>plot_pis</code>, the <code>plot_pds</code> function plots the partial dependency curves for individual predictors, with various levels of detail and smoothing available.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mypds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_pds.html">plot_pds</a></span>(<span class="dt">pd_name =</span> <span class="st">"EFFORT_HRS"</span>, 
                  <span class="dt">pds =</span> pds, 
                  <span class="dt">st_extent =</span> ne_extent, 
                  <span class="dt">pointwise_pi =</span> <span class="ot">TRUE</span>, 
                  <span class="dt">stixel_pds =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/plot_pds-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
<div id="cake-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#cake-plots" class="anchor"></a>8. Cake Plots</h1>
<p>Finally, when PIs and PDs are combined, it is possible to view predictor importance with directionality. By week, these can be turned into a stacked area chart (we affectionately call a “cake plot”“) that show the relative predictor importance and directionality by week. Here too, it is possible to aggregate Fragstats by land cover class or to leave them separate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this requires a fair amount of computation, about 5 minutes</span>
<span class="kw"><a href="../reference/cake_plot.html">cake_plot</a></span>(<span class="dt">path =</span> sp_path,
          <span class="dt">pis =</span> pis,
          <span class="dt">pds =</span> pds,
          <span class="dt">st_extent =</span> ne_extent,
          <span class="dt">by_cover_class =</span> <span class="ot">TRUE</span>,
          <span class="dt">pland_and_lpi_only =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="stemhelper-pipd_files/figure-html/cake_plots-1.png" width="\textwidth" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#outline">Outline</a></li>
      <li>
<a href="#introduction">1. Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data-structure">Data Structure</a></li>
      </ul>
</li>
      <li><a href="#loading-centroids">2. Loading Centroids</a></li>
      <li><a href="#selecting-region-and-season">3. Selecting Region and Season</a></li>
      <li><a href="#plotting-centroids-and-extent-of-analysis">4. Plotting Centroids and Extent of Analysis</a></li>
      <li>
<a href="#predictive-performance-metrics">5. Predictive Performance Metrics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#binary-metrics-by-time">Binary Metrics by Time</a></li>
      <li><a href="#all-metrics-for-spatiotemporal-extent">All Metrics for Spatiotemporal Extent</a></li>
      </ul>
</li>
      <li><a href="#plot-predictor-importance">6. Plot Predictor Importance</a></li>
      <li><a href="#plot-partial-depedencies">7. Plot Partial Depedencies</a></li>
      <li><a href="#cake-plots">8. Cake Plots</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://twitter.com/tom_auer">Tom Auer</a>, Daniel Fink.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
